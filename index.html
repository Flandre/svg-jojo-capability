<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title></title>
  <link href="dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
</head>
<body>
<div id="control" class="container" style="padding-top:30px;">
  <div class="form-horizontal">
    <div class="form-group">
      <label for="inputInfo" class="col-sm-2 control-label">关键词</label>
      <div class="col-sm-10">
        <input type="text" class="form-control" id="inputInfo" placeholder="请输入3组以上关键词，关键词之间用英文逗号 ( , ) 隔开">
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-offset-2 col-sm-10">
        <button type="submit" class="btn btn-default" id="createSvg">创建</button>
      </div>
    </div>
  </div>
</div>
<div id="svgCont" style="text-align: center">
</div>

<script>
  document.getElementById('createSvg').onclick = function(){
    var testText = '肝度,卖弱,安利,撞壁,素质';
    //处理输入数据
    var infoArr = testText.split(',');
    //var infoArr = document.getElementById('inputInfo').value.split(',');
    if(infoArr.length < 3){
      alert('输入数据有误，请重新输入')
    }else{
      //创建bootstrap表单
      var oCtrl = document.getElementById('control');
      oCtrl.innerHTML = '';

      var oForm = document.createElement('div');
      oForm.className = 'form-horizontal';

      for(var i = 0; i < infoArr.length; i++){
        var formGroup = document.createElement('div'),
            oLabel = document.createElement('label'),
            oInputBox = document.createElement('div'),
            oInput = document.createElement('input');

        formGroup.className = 'form-group';
        oLabel.setAttribute('for', 'input' + i);
        oLabel.setAttribute('class', 'col-sm-2 control-label');
        oLabel.appendChild(document.createTextNode('' + infoArr[i]));

        oInputBox.setAttribute('class', 'col-sm-10');
        oInput.setAttribute('type', 'text');
        oInput.setAttribute('class', 'form-control');
        oInput.setAttribute('id', 'input' + i);
        oInput.setAttribute('placeholder', infoArr[i] + '数值');

        oInputBox.appendChild(oInput);
        formGroup.appendChild(oLabel);
        formGroup.appendChild(oInputBox);

        oForm.appendChild(formGroup);
      }

      var btnGroup = document.createElement('div'),
        oBtnBox = document.createElement('div'),
        oBtn = document.createElement('button');
      btnGroup.className = 'form-group';
      oBtnBox.setAttribute('class', 'col-sm-offset-2 col-sm-10 row');
      oBtn.setAttribute('class', 'btn btn-default');

      var oBtnCreate = oBtn.cloneNode(true);
      oBtnCreate.setAttribute('id', 'createInfo');
      oBtnCreate.appendChild(document.createTextNode('生成'));

      var oBtnAdd = oBtn.cloneNode(true);
      oBtnAdd.setAttribute('id', 'addInfo');
      oBtnAdd.setAttribute('style', 'display:none');
      oBtnAdd.appendChild(document.createTextNode('添加'));

      oBtnBox.appendChild(oBtnCreate);
      oBtnBox.appendChild(oBtnAdd);
      btnGroup.appendChild(oBtnBox);
      oForm.appendChild(btnGroup);

      oCtrl.appendChild(oForm);
      //创建svg
      var oSvg = document.createElementNS('http://www.w3.org/2000/svg','svg');
      oSvg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
      oSvg.setAttribute('width', '500');
      oSvg.setAttribute('height', '500');
      oSvg.setAttribute('style', 'border:1px solid #000');

      //绘制刻度尺
      var scale = document.createElementNS('http://www.w3.org/2000/svg','path');
      scale.setAttribute('stroke-width', '2');
      scale.setAttribute('stroke', '#000');
      scale.setAttribute('d', 'M0,0 L200,0 M20,0 L20,5 M40,0 L40,10 M60,0 L60,5 M80,0 L80,10 M100,0 L100,5 M120,0 L120,10 M140,0 L140,5 M160,0 L160,10 M180,0 L180,5 M200,0 L200,10');

      //定位刻度
      var svgScaleObjArr = [];
      var svgScaleRotate = -90;
      for(var i = 0; i < infoArr.length; i++){
        svgScaleObjArr[i] = scale.cloneNode(true);
        svgScaleObjArr[i].setAttribute('transform', 'translate(250 250) rotate(' + svgScaleRotate + ')');
        oSvg.appendChild(svgScaleObjArr[i]);
        svgScaleRotate += 360/infoArr.length;
      }
      document.getElementById('svgCont').appendChild(oSvg);

      //生成信息
      var infoCount = 0;
      document.getElementById('createInfo').onclick = function(){
        createInfo(oSvg, infoArr.length, infoCount);
      };

      document.getElementById('addInfo').onclick = function(){
        infoCount ++;
        document.getElementById('addInfo').style.display = 'none'
      }
    }
  };

  function createInfo(svg, infoLength, pathCount){
    var dataArr = [];
    //输入判断
    var isNum = true;
    for(var i = 0; i < infoLength; i++){
      if(Number(document.getElementById('input' + i).value)){
        dataArr.push(document.getElementById('input' + i).value);
      }else{
        isNum = false;
      }
    }
    if(document.getElementsByTagName('path')[infoLength + pathCount * 2] == undefined){
      //创建显示数据
      if(isNum){
        drawData(svg, dataArr);
        //大于5则不再显示添加按钮
        if(pathCount < 5){
          document.getElementById('addInfo').style.display = 'inline-block';
        }
      }else{
        alert('请输入正确的数字');
      }
    }else{
      changeData(dataArr, infoLength, pathCount)
    }
  }

  //传入一个数组转换成path值
  function dataToPath(dataArr){
    var pathData = 'M';
    var pathRotate = 0;
    var maxData = eval('Math.max(' + dataArr.join(',') + ')');
    for(var i = 0; i < dataArr.length; i++){
      if(i){
        pathData += ' L'
      }
      pathData += dataArr[i]/maxData * -200 * Math.sin( pathRotate/180 * Math.PI );
      pathData += ',';
      pathData += dataArr[i]/maxData * -200 * Math.cos( pathRotate/180 * Math.PI );

      pathRotate += 360 / dataArr.length;
    }
    pathData += 'z';

    return pathData;
  }

  //创建数据显示
  function drawData(svgObj, svgData){
    var info = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    info.setAttribute('stroke-width', '2');
    info.setAttribute('stroke', '#F00');
    info.setAttribute('fill', 'none');

    var pathData = dataToPath( svgData );
    info.setAttribute('d', pathData);

    info.setAttribute('transform', 'translate(250 250)');
    svgObj.appendChild(info);

    var fillOpacity = info.cloneNode(true);
    fillOpacity.setAttribute('fill', '#F00');
    fillOpacity.setAttribute('style', 'opacity:0.3');
    svgObj.appendChild(fillOpacity);

  }

  //修改数据
  function changeData(data, length, count){
    var pathData = dataToPath(data);
    alert(pathData);
    for(var i = length; i < length + (count + 1) * 2; i++){
      document.getElementsByTagName('path')[i].setAttribute('d', pathData);
    }
  }
</script>

</body>
</html>